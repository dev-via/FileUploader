const express = require('express')
const debug = require('debug')('app:userrouter')
const multer = require('multer')
const path = require('path')

const router = express.Router()

//set the storage destination and naming
const storage = multer.diskStorage({
    destination: (req, file, cb) => {
        cb(null, './public/uploads')
    },
    filename: (req, file, cb) => {
        cb(null, file.fieldname + '-' + Date.now() + path.extname(file.originalname))
    }
});

// package for uploading
const upload = multer({ storage: storage })

// Routes
router.get('/', function(req,res) {
    return res.send(users)
})

router.get('/:id', function(req,res) {
    let id = req.params.id
    return res.send(users[id])
})

router.post('/', function(req,res) {
    users.push(req.body)
    return res.send(users)
})

//request will first go through multer and then req.file will be available
// router.post('/register', upload.single('file'), function(req,res) {
//     debug(req.file)
//     return res.send(req.file)
// })
//
// router.put('/:index', function(req,res){
//     let index = req.params.index
//     users[index] = req.body
//     return res.send(users)
// })
//
// router.delete('/last', function(req,res){
//     res.send(users.pop())
// })
//make it available to be used in index.js
module.exports = router
